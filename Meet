local JakeModule = {}

local RS = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local Mouse = RS:FindFirstChild("Mouse") 
local Skills = {"Z", "X", "C", "V", "F"}

local realMouseHit = nil
local realMouseTarget = nil

if Mouse then
    pcall(function()
        realMouseHit = Mouse.Hit and Mouse.Hit
        realMouseTarget = Mouse.Target and Mouse.Target
    end)
end

RunService.Heartbeat:Connect(function()
    if Mouse then
        pcall(function()
            realMouseHit = Mouse.Hit or realMouseHit
            realMouseTarget = Mouse.Target or realMouseTarget
        end)

        local gp = getgenv()
        if gp and gp.NPCPosition then
            pcall(function() Mouse.Hit = CFrame.new(gp.NPCPosition) end)
        elseif gp and gp.PlayersPosition then
            pcall(function() Mouse.Hit = CFrame.new(gp.PlayersPosition) end)
        end
    end
end)

spawn(function()
    local success, gg = pcall(function() return getrawmetatable(game) end)
    if not success or not gg then return end
    local old = gg.__namecall
    if not old then return end

    setreadonly(gg, false)
    gg.__namecall = newcclosure(function(self, ...)
        local method = getnamecallmethod and getnamecallmethod() or ""
        local args = {...}

        local gp = getgenv()
        local targetPos = nil
        if gp and gp.SilentAimPlayersEnabled and gp.PlayersPosition then
            targetPos = gp.PlayersPosition
        elseif gp and gp.SilentAimNPCsEnabled and gp.NPCPosition then
            targetPos = gp.NPCPosition
        end

        if tostring(method) == "InvokeServer" then
            if typeof(args[1]) == "string" then
                local skill = args[1]:upper()

                if skill == "TAP" then
                    args[2] = (realMouseHit and realMouseHit.p) or args[2]
                    return old(self, unpack(args))
                end

                if table.find(Skills, skill) then
                    if targetPos then
                        args[2] = targetPos
                    end
                    return old(self, unpack(args))
                end
            end
        end

        return old(self, ...)
    end)
    setreadonly(gg, true)
end)

return JakeModule
