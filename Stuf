local StuffsModule = {}

local BuddySwordXEnabled = false
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- Function to get HumanoidRootPart safely
local function getHRP(char)
	return char and char:FindFirstChild("HumanoidRootPart")
end

-- Function to get nearest player
local function getNearestTarget()
	local char = LocalPlayer.Character
	local hrp = getHRP(char)
	if not hrp then return nil end

	local nearestDist = math.huge
	local nearestTarget = nil

	for _, plr in pairs(Players:GetPlayers()) do
		if plr ~= LocalPlayer and plr.Character then
			local targetHRP = getHRP(plr.Character)
			if targetHRP then
				local dist = (hrp.Position - targetHRP.Position).Magnitude
				if dist < nearestDist then
					nearestDist = dist
					nearestTarget = plr
				end
			end
		end
	end

	return nearestTarget
end

-- Function to fire X skill at nearest target
local function fireXSkill()
	if not BuddySwordXEnabled then return end  -- Only fire if toggled on

	local target = getNearestTarget()
	if target and target.Character then
		local targetHRP = getHRP(target.Character)
		if targetHRP then
			local pos = targetHRP.Position
			local args = {
				"X",
				Vector3.new(pos.X, pos.Y, pos.Z)
			}

			-- Replace "" with the actual RemoteFunction name
			local remote = LocalPlayer.Character:FindFirstChild("")
			if remote then
				remote:InvokeServer(unpack(args))
			else
				warn("RemoteFunction not found in character")
			end
		end
	end
end

-- Public toggle function
function StuffsModule:SetBuddySwordX(state)
	BuddySwordXEnabled = state
	if state then
		fireXSkill()
	end
end

return StuffsModule
